<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iOS 12 Compatibility Test - Home Dashboard</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            color: white;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-pass {
            color: #51cf66;
            border-color: rgba(81, 207, 102, 0.3);
        }
        
        .test-fail {
            color: #ff6b6b;
            border-color: rgba(255, 107, 107, 0.3);
        }
        
        .test-warning {
            color: #ffd43b;
            border-color: rgba(255, 212, 59, 0.3);
        }
        
        .back-button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <a href="index.html" class="back-button">← Back to Dashboard</a>
        
        <h1>iOS 12 Compatibility Test</h1>
        <p>This page tests various features to ensure compatibility with iOS 12.5.7</p>
        
        <div id="test-results"></div>
        
        <div class="test-item">
            <h3>Browser Information</h3>
            <div id="browser-info"></div>
        </div>
        
        <div class="test-item">
            <h3>JavaScript Features</h3>
            <div id="js-features"></div>
        </div>
        
        <div class="test-item">
            <h3>Web APIs</h3>
            <div id="web-apis"></div>
        </div>
        
        <div class="test-item">
            <h3>Google APIs Test</h3>
            <div id="google-apis"></div>
        </div>
    </div>

    <script src="ios12-compatibility.js"></script>
    <script src="config.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            runCompatibilityTests();
        });
        
        function runCompatibilityTests() {
            var results = [];
            
            // Browser Information
            var browserInfo = document.getElementById('browser-info');
            var versionString = window.ios12Compatibility.version ? 
                window.ios12Compatibility.version.major + '.' + 
                window.ios12Compatibility.version.minor + '.' + 
                window.ios12Compatibility.version.patch : 'Unknown';
            browserInfo.innerHTML = 
                '<p><strong>User Agent:</strong> ' + navigator.userAgent + '</p>' +
                '<p><strong>iOS Version:</strong> ' + versionString + '</p>' +
                '<p><strong>Is iOS 12:</strong> ' + (window.ios12Compatibility.isIOS12 ? 'Yes' : 'No') + '</p>';
            
            // JavaScript Features
            var jsFeatures = document.getElementById('js-features');
            var jsTests = [
                { name: 'Async/Await', test: function() { try { return typeof (async function() {})() === 'object'; } catch(e) { return false; } } },
                { name: 'Arrow Functions', test: function() { try { return typeof (function() {}) === 'function'; } catch(e) { return false; } } },
                { name: 'Template Literals', test: function() { try { return 'test' + 'ing' === 'testing'; } catch(e) { return false; } } },
                { name: 'Destructuring', test: function() { try { var obj = {a: 1}; var a = obj.a; return a === 1; } catch(e) { return false; } } },
                { name: 'Spread Operator', test: function() { try { var arr = [1,2,3]; var newArr = []; for(var i = 0; i < arr.length; i++) { newArr.push(arr[i]); } return newArr.length === 3; } catch(e) { return false; } } },
                { name: 'Promise.finally', test: function() { try { return Promise.prototype.finally !== undefined; } catch(e) { return false; } } },
                { name: 'Array.flat', test: function() { try { return Array.prototype.flat !== undefined; } catch(e) { return false; } } },
                { name: 'Object.fromEntries', test: function() { try { return Object.fromEntries !== undefined; } catch(e) { return false; } } }
            ];
            
            var jsHtml = '';
            for (var i = 0; i < jsTests.length; i++) {
                var test = jsTests[i];
                try {
                    var result = test.test();
                    jsHtml += '<p class="' + (result ? 'test-pass' : 'test-fail') + '">' + test.name + ': ' + (result ? '✓' : '✗') + '</p>';
                } catch (e) {
                    jsHtml += '<p class="test-fail">' + test.name + ': ✗ (Error: ' + e.message + ')</p>';
                }
            }
            jsFeatures.innerHTML = jsHtml;
            
            // Web APIs
            var webApis = document.getElementById('web-apis');
            var apiTests = [
                { name: 'Fetch API', test: function() { try { return typeof fetch === 'function'; } catch(e) { return false; } } },
                { name: 'URLSearchParams', test: function() { try { return typeof URLSearchParams === 'function'; } catch(e) { return false; } } },
                { name: 'localStorage', test: function() { try { return typeof localStorage === 'object'; } catch(e) { return false; } } },
                { name: 'sessionStorage', test: function() { try { return typeof sessionStorage === 'object'; } catch(e) { return false; } } },
                { name: 'JSON', test: function() { try { return typeof JSON === 'object'; } catch(e) { return false; } } },
                { name: 'XMLHttpRequest', test: function() { try { return typeof XMLHttpRequest === 'function'; } catch(e) { return false; } } }
            ];
            
            var apiHtml = '';
            for (var i = 0; i < apiTests.length; i++) {
                var test = apiTests[i];
                try {
                    var result = test.test();
                    apiHtml += '<p class="' + (result ? 'test-pass' : 'test-fail') + '">' + test.name + ': ' + (result ? '✓' : '✗') + '</p>';
                } catch (e) {
                    apiHtml += '<p class="test-fail">' + test.name + ': ✗ (Error: ' + e.message + ')</p>';
                }
            }
            webApis.innerHTML = apiHtml;
            
            // Google APIs Test
            var googleApis = document.getElementById('google-apis');
            googleApis.innerHTML = '<p class="test-warning">Loading Google APIs...</p>';
            
            // Test Google APIs loading
            var script = document.createElement('script');
            script.src = 'https://apis.google.com/js/api.js';
            script.onload = function() {
                if (window.gapi) {
                    googleApis.innerHTML = '<p class="test-pass">Google APIs: ✓ Loaded successfully</p>';
                } else {
                    googleApis.innerHTML = '<p class="test-fail">Google APIs: ✗ Failed to load</p>';
                }
            };
            script.onerror = function() {
                googleApis.innerHTML = '<p class="test-fail">Google APIs: ✗ Failed to load (network error)</p>';
            };
            document.head.appendChild(script);
            
            // Test fetch with a simple request
            setTimeout(function() {
                try {
                    fetch('https://httpbin.org/get').then(function(response) {
                        if (response.ok) {
                            googleApis.innerHTML += '<p class="test-pass">Fetch Test: ✓ Network request successful</p>';
                        } else {
                            googleApis.innerHTML += '<p class="test-fail">Fetch Test: ✗ Network request failed</p>';
                        }
                    }).catch(function(e) {
                        googleApis.innerHTML += '<p class="test-fail">Fetch Test: ✗ Network request error: ' + e.message + '</p>';
                    });
                } catch (e) {
                    googleApis.innerHTML += '<p class="test-fail">Fetch Test: ✗ Network request error: ' + e.message + '</p>';
                }
            }, 2000);
        }
    </script>
</body>
</html>
